function isc_toggle_module_sections(){Object.entries(isc.moduleSections).forEach(([e,t])=>{const n=document.querySelector(`#isc-settings-plugin-modules input[value="${e}"]`);n&&t.forEach(e=>{const t=document.getElementById(e),s=t?t.querySelector(".inside"):null;s&&(n.checked?s.classList.remove("hidden"):s.classList.add("hidden"))})})}function isc_thumbnail_input_checkstate(){document.getElementById("use-thumbnail").checked?document.getElementById("thumbnail-size-select").classList.remove("hidden"):document.getElementById("thumbnail-size-select").classList.add("hidden"),"custom"===document.getElementById("thumbnail-size-select").value&&document.getElementById("use-thumbnail").checked?document.getElementById("isc-settings-custom-size").classList.remove("hidden"):document.getElementById("isc-settings-custom-size").classList.add("hidden")}function isc_caption_checkstate(){var e=document.getElementById("isc-settings-overlay-enable");if(e){var t=document.querySelectorAll(".isc_settings_section_overlay .form-table tr:not(:first-of-type)");e.checked?Array.prototype.forEach.call(t,function(e,t){e.style.display="table-row"}):Array.prototype.forEach.call(t,function(e,t){e.style.display="none"})}}function isc_licenses_checkstate(){var e=document.getElementById("isc-settings-licenses-enable");if(e){var t=document.querySelectorAll(".isc_settings_section_licenses .form-table tr:not(:first-of-type)");e.checked?Array.prototype.forEach.call(t,function(e,t){e.style.display="table-row"}):Array.prototype.forEach.call(t,function(e,t){e.style.display="none"})}}function isc_toggle_standard_source_text(){var e=document.getElementById("isc-custom-text-select");e&&(e.checked?document.getElementById("isc-custom-text").removeAttribute("disabled"):document.getElementById("isc-custom-text").setAttribute("disabled","disabled"))}function isc_toggle_caption_position(){var e=document.querySelector("#isc-settings-caption-style input:checked");e&&("none"===e.value?(document.getElementById("isc-settings-caption-position-options-wrapper").classList.add("hidden"),document.getElementById("isc-settings-caption-position-options-wrapper").previousElementSibling.classList.add("hidden")):(document.getElementById("isc-settings-caption-position-options-wrapper").classList.remove("hidden"),document.getElementById("isc-settings-caption-position-options-wrapper").previousElementSibling.classList.remove("hidden")))}function isc_show_reindex_warning(){document.getElementById("isc-settings-global-list-indexed-images-warning").classList.remove("hidden")}jQuery(document).ready(function(e){isc_thumbnail_input_checkstate(),isc_caption_checkstate(),isc_licenses_checkstate(),isc_toggle_caption_position(),isc_toggle_module_sections(),e("#isc-settings-overlay-enable").on("click",function(){isc_caption_checkstate()}),e("#isc-settings-licenses-enable").on("click",function(){isc_licenses_checkstate()}),e(".isc-settings-standard-source input").on("change",isc_toggle_standard_source_text),e("#thumbnail-size-select, #use-thumbnail").on("change",function(){isc_thumbnail_input_checkstate()}),e("#isc-settings-caption-style input").on("change",function(){isc_toggle_caption_position()}),e("#isc-settings-global-list-indexed-images").on("change",function(){isc_show_reindex_warning()}),e('#isc-settings-plugin-modules input[type="checkbox"]').on("change",function(){isc_toggle_module_sections()}),e("#isc-settings-plugin-images-only").on("change",function(){const t=this.checked;e("#isc-settings-plugin-images-only-indexer").toggleClass("hidden"),e("#isc-settings-plugin-images-only-cleanup-wrapper").toggleClass("hidden",!t)}),e("#isc-copy-log-url-btn").on("click",function(){const t=document.getElementById("isc-log-url-field");if(!t)return;const n=function(){e("#isc-copy-log-url-success").stop(!0,!0).fadeIn().delay(2e3).fadeOut()},s=function(){t.focus(),t.select(),t.setSelectionRange(0,t.value.length),document.execCommand("copy")&&n()};navigator.clipboard?.writeText?navigator.clipboard.writeText(t.value).then(n).catch(s):s()}),e("#isc-download-log-btn").on("click",function(){e.ajax({type:"POST",url:ajaxurl,data:{action:"isc_download_log",nonce:isc.logDownloadNonce},xhrFields:{responseType:"blob"},success:function(e,t,n){const s=n.getResponseHeader("Content-Disposition");let i="image-source-control.log";if(s&&-1!==s.indexOf("filename=")){const e=s.match(/filename="?([^"]+)"?/);e&&e[1]&&(i=e[1])}const c=new Blob([e],{type:"text/plain"}),o=window.URL.createObjectURL(c),l=document.createElement("a");l.href=o,l.download=i,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(o)},error:function(e){console.error("Error downloading log file:",e.statusText),alert("Error downloading log file. Please check the console for details.")}})}),e("#isc-enable-log-checkbox").on("change",function(){e("#isc-log-url-wrapper").toggle(this.checked)}),e("#isc-settings-caption-pos-options button").on("click",function(t){t.stopPropagation(),e("#isc-settings-caption-pos-options button.selected").removeClass("selected"),e(this).addClass("selected"),e("#isc-settings-caption-position").val(e(this).data("position"));var n=document.createElement("iframe");n.src=isc_settings.baseurl+"admin/templates/settings/preview/caption-preview.html?position="+e(this).data("position")+"&pretext="+encodeURIComponent(e("#source-pretext").val()),n.width="250",n.height="181";var s=e("#isc-settings-caption-preview");s.find("iframe").remove(),s.append(n),s.removeClass("hidden")}),e(document).on("click mouseout",function(t){e(t.target).closest("#isc-settings-caption-pos-options").length||e("#isc-settings-caption-preview").addClass("hidden")}),e("#isc-signup-nl").prop("disabled",!1),e("#isc-signup-nl").on("click",function(){e("#isc-signup-nl").prop("disabled",!0),e("#isc-signup-loader").removeClass("hidden"),e.ajax({type:"POST",url:ajaxurl,data:{action:"newsletter_signup",nonce:isc.ajaxNonce},dataType:"json",success:function(t){t.success?e("#isc-signup-nl-success").removeClass("hidden").html(t.message):e("#isc-signup-nl-error").removeClass("hidden").html(t.message),e("#isc-signup-loader").addClass("hidden")}})}),e("#isc_settings_section_signup .postbox-header .dashicons-no-alt").on("click",function(){e("#isc-signup-nl").prop("disabled",!0),e("#isc-signup-loader").removeClass("hidden"),e.ajax({type:"POST",url:ajaxurl,data:{action:"newsletter_close",nonce:isc.ajaxNonce},dataType:"json",success:function(t){e("#isc_settings_section_signup").remove()}})}),document.querySelectorAll("#source-pretext-buttons button").forEach(function(e){e.addEventListener("click",function(){var e=document.getElementById("source-pretext");e.value+=this.textContent,e.focus()})}),document.getElementById("source-pretext").addEventListener("focus",function(){document.getElementById("source-pretext-buttons").classList.remove("hidden")})});